<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¼¸å…¥æ–°çš„å…§å®¹ - è©å½™å­¸ç¿’åŠ©æ‰‹</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .progress-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
        }
        .step {
            flex: 1;
            text-align: center;
            padding: 10px;
            border-radius: 4px;
            margin: 0 5px;
            background-color: #ecf0f1;
            font-weight: bold;
        }
        .step.active {
            background-color: #3498db;
            color: white;
        }
        .step.completed {
            background-color: #27ae60;
            color: white;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #34495e;
        }
        input[type="text"],
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            box-sizing: border-box;
        }
        textarea {
            width: 100%;
            height: 200px;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            font-family: monospace;
            box-sizing: border-box;
            resize: vertical;
        }
        .radio-group {
            margin: 15px 0;
        }
        .radio-option {
            margin: 10px 0;
        }
        .radio-option input[type="radio"] {
            margin-right: 8px;
            cursor: pointer;
        }
        .radio-option label {
            display: inline;
            margin: 0;
            font-weight: normal;
            cursor: pointer;
        }
        .step-content {
            display: none;
        }
        .step-content.active {
            display: block;
        }
        .btn {
            display: inline-block;
            background-color: #3498db;
            color: white;
            padding: 12px 24px;
            text-decoration: none;
            border-radius: 4px;
            margin: 10px 5px 10px 0;
            transition: background-color 0.3s;
            border: none;
            cursor: pointer;
            font-size: 16px;
        }
        .btn:hover {
            background-color: #2980b9;
        }
        .btn-back {
            background-color: #95a5a6;
        }
        .btn-back:hover {
            background-color: #7f8c8d;
        }
        .btn:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }
        .instructions {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
            border-left: 4px solid #3498db;
        }
        .summary-box {
            background-color: #ecf0f1;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
        }
        .paragraph-item {
            background-color: #f8f9fa;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
            border-left: 4px solid #3498db;
        }
        .remove-btn {
            background-color: #e74c3c;
            padding: 8px 15px;
            font-size: 14px;
            margin-top: 10px;
        }
        .remove-btn:hover {
            background-color: #c0392b;
        }
        .add-paragraph-btn {
            background-color: #27ae60;
            margin-top: 15px;
        }
        .add-paragraph-btn:hover {
            background-color: #229954;
        }
        .sentence-input {
            margin: 10px 0;
        }
        .sentence-input input {
            margin-bottom: 5px;
        }
        .remove-sentence-btn {
            background-color: #e74c3c;
            padding: 5px 10px;
            font-size: 12px;
        }
        .remove-sentence-btn:hover {
            background-color: #c0392b;
        }
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 30px;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“ è¼¸å…¥æ–°çš„å…§å®¹</h1>
        
        <div class="progress-bar">
            <div class="step active" id="step-indicator-1">ç¬¬ä¸€æ­¥ï¼šé¸æ“‡èªè¨€</div>
            <div class="step" id="step-indicator-2">ç¬¬äºŒæ­¥ï¼šèª²ç¨‹ç·¨è™Ÿ</div>
            <div class="step" id="step-indicator-3">ç¬¬ä¸‰æ­¥ï¼šå…§å®¹é¡å‹</div>
            <div class="step" id="step-indicator-4">ç¬¬å››æ­¥ï¼šè¼¸å…¥å…§å®¹</div>
            <div class="step" id="step-indicator-5">ç¬¬äº”æ­¥ï¼šç¢ºèªæäº¤</div>
        </div>

        <form id="lessonsForm" method="POST">
            <!-- Step 1: Language Selection -->
            <div class="step-content active" id="step-1">
                <h2>ç¬¬ä¸€æ­¥ï¼šé¸æ“‡èªè¨€</h2>
                <div class="form-group">
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="lang-chinese" name="language" value="ä¸­æ–‡" required>
                            <label for="lang-chinese">ä¸­æ–‡</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="lang-english" name="language" value="è‹±æ–‡">
                            <label for="lang-english">è‹±æ–‡</label>
                        </div>
                    </div>
                </div>
                <button type="button" class="btn" onclick="nextStep(1)">ä¸‹ä¸€æ­¥</button>
            </div>

            <!-- Step 2: Lesson Number -->
            <div class="step-content" id="step-2">
                <h2>ç¬¬äºŒæ­¥ï¼šèª²ç¨‹ç·¨è™Ÿ</h2>
                <div class="form-group">
                    <label for="lesson_number">è«‹è¼¸å…¥èª²ç¨‹ç·¨è™Ÿ (ä¾‹å¦‚ï¼šç¬¬ä¸€èª²ã€ç¬¬äºŒèª²ã€ç¬¬ä¸‰èª²):</label>
                    <input type="text" id="lesson_number" name="lesson_number" placeholder="ä¾‹å¦‚ï¼šç¬¬ä¸€èª²" required>
                </div>
                <button type="button" class="btn btn-back" onclick="prevStep(2)">ä¸Šä¸€æ­¥</button>
                <button type="button" class="btn" onclick="nextStep(2)">ä¸‹ä¸€æ­¥</button>
            </div>

            <!-- Step 3: Content Type -->
            <div class="step-content" id="step-3">
                <h2>ç¬¬ä¸‰æ­¥ï¼šå…§å®¹é¡å‹</h2>
                <div class="form-group">
                    <p>è«‹é¸æ“‡é€™æ¬¡è¦æ·»åŠ çš„å…§å®¹é¡å‹ï¼š</p>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="type-words" name="content_type" value="è©èª" required onchange="updateContentTypeDisplay()">
                            <label for="type-words">è©èª (é€å€‹è©å½™è½å¯«)</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="type-paragraphs" name="content_type" value="æ®µè½" onchange="updateContentTypeDisplay()">
                            <label for="type-paragraphs">æ®µè½ (é€å¥è½å¯«)</label>
                        </div>
                    </div>
                </div>
                <button type="button" class="btn btn-back" onclick="prevStep(3)">ä¸Šä¸€æ­¥</button>
                <button type="button" class="btn" onclick="nextStep(3)">ä¸‹ä¸€æ­¥</button>
            </div>

            <!-- Step 4: Input Content -->
            <div class="step-content" id="step-4">
                <h2>ç¬¬å››æ­¥ï¼šè¼¸å…¥å…§å®¹</h2>
                
                <!-- Words Input Section -->
                <div id="words-section" class="hidden">
                    <div class="instructions">
                        <h4>ğŸ“ è©èªè¼¸å…¥èªªæ˜</h4>
                        <p>åœ¨ä¸‹æ–¹æ–‡æœ¬æ¡†ä¸­è¼¸å…¥è©èªï¼Œæ¯è¡Œä¸€å€‹ã€‚ç³»çµ±æœƒè‡ªå‹•ä¿å­˜æ‰€æœ‰è©èªã€‚</p>
                        <p>ç¤ºä¾‹ï¼š<br>è˜‹æœ<br>é¦™è•‰<br>æ©™å­</p>
                    </div>
                    <div class="form-group">
                        <label for="words_input">è«‹è¼¸å…¥è©èª (æ¯è¡Œä¸€å€‹):</label>
                        <textarea id="words_input" name="words_input" placeholder="è˜‹æœ
é¦™è•‰
æ©™å­
è‘¡è„
è¥¿ç“œ"></textarea>
                    </div>
                </div>

                <!-- Paragraphs Input Section -->
                <div id="paragraphs-section" class="hidden">
                    <div class="instructions">
                        <h4>ğŸ“ æ®µè½è¼¸å…¥èªªæ˜</h4>
                        <p>æ¯å€‹æ®µè½éœ€è¦ï¼š</p>
                        <ul>
                            <li>æ®µè½æ¨™é¡Œï¼ˆä¾‹å¦‚ï¼šå®¶åº­ä»‹ç´¹ï¼‰</li>
                            <li>å¥å­ - æ¯è¡Œä¸€å€‹å¥å­ï¼Œç³»çµ±å°‡é€å¥é€²è¡Œè½å¯«</li>
                        </ul>
                        <p>æ‚¨å¯ä»¥æ·»åŠ å¤šå€‹æ®µè½ï¼Œæ¯å€‹æ®µè½æœƒåˆ†é–‹è™•ç†ã€‚</p>
                    </div>
                    <div id="paragraphs-list"></div>
                    <button type="button" class="btn add-paragraph-btn" onclick="addParagraph()">â• æ·»åŠ æ–°æ®µè½</button>
                </div>

                <button type="button" class="btn btn-back" onclick="prevStep(4)">ä¸Šä¸€æ­¥</button>
                <button type="button" class="btn" onclick="nextStep(4)">ä¸‹ä¸€æ­¥</button>
            </div>

            <!-- Step 5: Confirm and Submit -->
            <div class="step-content" id="step-5">
                <h2>ç¬¬äº”æ­¥ï¼šç¢ºèªæäº¤</h2>
                <div class="summary-box" id="summary"></div>
                
                <div class="button-group">
                    <button type="button" class="btn btn-back" onclick="prevStep(5)">ä¸Šä¸€æ­¥</button>
                    <button type="submit" class="btn" style="background-color: #27ae60;">âœ“ ç¢ºèªæäº¤</button>
                    <a href="{{ url_for('index') }}" class="btn btn-back">è¿”å›é¦–é </a>
                </div>
            </div>
        </form>
    </div>

    <script>
        let currentStep = 1;
        const totalSteps = 5;

        function updateStepIndicator(step) {
            for (let i = 1; i <= totalSteps; i++) {
                const indicator = document.getElementById(`step-indicator-${i}`);
                if (i === step) {
                    indicator.classList.add('active');
                    indicator.classList.remove('completed');
                } else if (i < step) {
                    indicator.classList.add('completed');
                    indicator.classList.remove('active');
                } else {
                    indicator.classList.remove('active', 'completed');
                }
            }
        }

        function updateContentTypeDisplay() {
            const wordsSection = document.getElementById('words-section');
            const paragraphsSection = document.getElementById('paragraphs-section');
            const contentType = document.querySelector('input[name="content_type"]:checked')?.value;

            if (contentType === 'è©èª') {
                wordsSection.classList.remove('hidden');
                paragraphsSection.classList.add('hidden');
            } else if (contentType === 'æ®µè½') {
                wordsSection.classList.add('hidden');
                paragraphsSection.classList.remove('hidden');
                if (document.getElementById('paragraphs-list').children.length === 0) {
                    addParagraph();
                }
            }
        }

        function nextStep(currentStepNum) {
            if (validateStep(currentStepNum)) {
                currentStep = currentStepNum + 1;
                showStep(currentStep);
            }
        }

        function prevStep(currentStepNum) {
            currentStep = currentStepNum - 1;
            showStep(currentStep);
        }

        function showStep(step) {
            for (let i = 1; i <= totalSteps; i++) {
                document.getElementById(`step-${i}`).classList.remove('active');
            }
            document.getElementById(`step-${step}`).classList.add('active');
            updateStepIndicator(step);
            
            if (step === 5) {
                generateSummary();
            }
        }

        function validateStep(step) {
            switch(step) {
                case 1:
                    if (!document.querySelector('input[name="language"]:checked')) {
                        alert('è«‹é¸æ“‡ä¸€ç¨®èªè¨€');
                        return false;
                    }
                    return true;
                case 2:
                    if (!document.getElementById('lesson_number').value.trim()) {
                        alert('è«‹è¼¸å…¥èª²ç¨‹ç·¨è™Ÿ');
                        return false;
                    }
                    return true;
                case 3:
                    if (!document.querySelector('input[name="content_type"]:checked')) {
                        alert('è«‹é¸æ“‡å…§å®¹é¡å‹');
                        return false;
                    }
                    return true;
                case 4:
                    const contentType = document.querySelector('input[name="content_type"]:checked').value;
                    if (contentType === 'è©èª') {
                        if (!document.getElementById('words_input').value.trim()) {
                            alert('è«‹è¼¸å…¥è‡³å°‘ä¸€å€‹è©èª');
                            return false;
                        }
                    } else if (contentType === 'æ®µè½') {
                        const paragraphs = document.querySelectorAll('.paragraph-item');
                        if (paragraphs.length === 0) {
                            alert('è«‹è‡³å°‘æ·»åŠ ä¸€å€‹æ®µè½');
                            return false;
                        }
                        for (let para of paragraphs) {
                            const title = para.querySelector('input[name="paragraph_title"]').value.trim();
                            const sentences = para.querySelectorAll('input[name="paragraph_sentence"]');
                            if (!title) {
                                alert('è«‹è¼¸å…¥æ®µè½æ¨™é¡Œ');
                                return false;
                            }
                            if (sentences.length === 0 || !Array.from(sentences).some(s => s.value.trim())) {
                                alert('è«‹ç‚ºæ¯å€‹æ®µè½è‡³å°‘è¼¸å…¥ä¸€å€‹å¥å­');
                                return false;
                            }
                        }
                    }
                    return true;
                default:
                    return true;
            }
        }

        function addParagraph() {
            const container = document.getElementById('paragraphs-list');
            const index = container.children.length;
            
            const paragraphDiv = document.createElement('div');
            paragraphDiv.className = 'paragraph-item';
            paragraphDiv.id = `paragraph-${index}`;
            
            paragraphDiv.innerHTML = `
                <h4>æ®µè½ ${index + 1}</h4>
                <div class="form-group">
                    <label>æ®µè½æ¨™é¡Œ:</label>
                    <input type="text" name="paragraph_title" placeholder="ä¾‹å¦‚ï¼šå®¶åº­ä»‹ç´¹" required>
                </div>
                <div class="form-group">
                    <label>å¥å­:</label>
                    <div id="sentences-list-${index}"></div>
                    <button type="button" class="btn" onclick="addSentence(${index})" style="margin-top: 10px;">â• æ·»åŠ å¥å­</button>
                </div>
                <button type="button" class="remove-btn" onclick="removeParagraph(${index})">ğŸ—‘ï¸ åˆªé™¤æ®µè½</button>
            `;
            
            container.appendChild(paragraphDiv);
            addSentence(index);
        }

        function addSentence(paragraphIndex) {
            const sentenceList = document.getElementById(`sentences-list-${paragraphIndex}`);
            const sentenceIndex = sentenceList.children.length;
            
            const sentenceDiv = document.createElement('div');
            sentenceDiv.className = 'sentence-input';
            sentenceDiv.id = `sentence-${paragraphIndex}-${sentenceIndex}`;
            
            sentenceDiv.innerHTML = `
                <div style="display: flex; gap: 10px; margin-bottom: 8px;">
                    <input type="text" name="paragraph_sentence" placeholder="è¼¸å…¥å¥å­ ${sentenceIndex + 1}" style="flex: 1;" required>
                    ${sentenceIndex > 0 ? `<button type="button" class="remove-sentence-btn" onclick="removeSentence(${paragraphIndex}, ${sentenceIndex})">âœ•</button>` : ''}
                </div>
            `;
            
            sentenceList.appendChild(sentenceDiv);
        }

        function removeSentence(paragraphIndex, sentenceIndex) {
            document.getElementById(`sentence-${paragraphIndex}-${sentenceIndex}`).remove();
        }

        function removeParagraph(paragraphIndex) {
            document.getElementById(`paragraph-${paragraphIndex}`).remove();
        }

        function generateSummary() {
            const language = document.querySelector('input[name="language"]:checked').value;
            const lessonNumber = document.getElementById('lesson_number').value;
            const contentType = document.querySelector('input[name="content_type"]:checked').value;
            
            let summary = `
                <h3>âœ“ èª²ç¨‹ä¿¡æ¯ç¢ºèª</h3>
                <p><strong>èªè¨€ï¼š</strong> ${language}</p>
                <p><strong>èª²ç¨‹ç·¨è™Ÿï¼š</strong> ${lessonNumber}</p>
                <p><strong>å…§å®¹é¡å‹ï¼š</strong> ${contentType}</p>
            `;
            
            if (contentType === 'è©èª') {
                const words = document.getElementById('words_input').value
                    .split('\n')
                    .map(w => w.trim())
                    .filter(w => w);
                summary += `<p><strong>è©èªæ•¸é‡ï¼š</strong> ${words.length}</p>`;
                summary += '<p><strong>è©èªåˆ—è¡¨ï¼š</strong></p><ul>';
                words.forEach(word => {
                    summary += `<li>${word}</li>`;
                });
                summary += '</ul>';
            } else if (contentType === 'æ®µè½') {
                const paragraphs = document.querySelectorAll('.paragraph-item');
                summary += `<p><strong>æ®µè½æ•¸é‡ï¼š</strong> ${paragraphs.length}</p>`;
                paragraphs.forEach((para, idx) => {
                    const title = para.querySelector('input[name="paragraph_title"]').value;
                    const sentences = para.querySelectorAll('input[name="paragraph_sentence"]');
                    const sentenceCount = Array.from(sentences).filter(s => s.value.trim()).length;
                    summary += `<p><strong>æ®µè½ ${idx + 1}ï¼š${title}</strong> (${sentenceCount} å¥)</p>`;
                });
            }
            
            document.getElementById('summary').innerHTML = summary;
        }

        // Initialize
        document.getElementById('lessonsForm').addEventListener('submit', function(e) {
            e.preventDefault();
            // Convert form data and submit
            submitLesson();
        });

        async function submitLesson() {
            const language = document.querySelector('input[name="language"]:checked').value;
            const lessonNumber = document.getElementById('lesson_number').value;
            const contentType = document.querySelector('input[name="content_type"]:checked').value;
            
            const data = {
                language: language,
                lesson_number: lessonNumber,
                content_type: contentType
            };
            
            if (contentType === 'è©èª') {
                const words = document.getElementById('words_input').value
                    .split('\n')
                    .map(w => w.trim())
                    .filter(w => w);
                data.words = words;
            } else if (contentType === 'æ®µè½') {
                const paragraphs = [];
                document.querySelectorAll('.paragraph-item').forEach(para => {
                    const title = para.querySelector('input[name="paragraph_title"]').value;
                    const sentences = Array.from(para.querySelectorAll('input[name="paragraph_sentence"]'))
                        .map(s => s.value.trim())
                        .filter(s => s);
                    paragraphs.push({ title, sentences });
                });
                data.paragraphs = paragraphs;
            }
            
            try {
                const response = await fetch('/add_content', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    alert('èª²ç¨‹å·²æˆåŠŸæ·»åŠ ï¼');
                    window.location.href = '{{ url_for("index") }}';
                } else {
                    alert('æ·»åŠ å¤±æ•—ï¼Œè«‹é‡è©¦');
                }
            } catch (error) {
                alert('éŒ¯èª¤ï¼š' + error);
            }
        }
    </script>
</body>
</html>