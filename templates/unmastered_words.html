<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœªæŒæ¡å–®è© - è©å½™å­¸ç¿’åŠ©æ‰‹</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #e74c3c;
            padding-bottom: 15px;
        }
        .summary-box {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 20px;
            border-radius: 4px;
            margin-bottom: 30px;
        }
        .summary-box h2 {
            margin: 0 0 10px 0;
            color: #856404;
            font-size: 18px;
        }
        .summary-box p {
            margin: 8px 0;
            color: #666;
        }
        .button-group {
            text-align: center;
            margin: 20px 0;
        }
        .btn {
            display: inline-block;
            background-color: #3498db;
            color: white;
            padding: 12px 24px;
            text-decoration: none;
            border-radius: 4px;
            margin: 10px 5px;
            transition: background-color 0.3s;
            border: none;
            cursor: pointer;
            font-size: 14px;
        }
        .btn:hover {
            background-color: #2980b9;
        }
        .btn-quiz {
            background-color: #e74c3c;
            font-weight: bold;
        }
        .btn-quiz:hover {
            background-color: #c0392b;
        }
        .btn-back {
            background-color: #95a5a6;
        }
        .btn-back:hover {
            background-color: #7f8c8d;
        }
        .words-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 30px;
        }
        .word-card {
            background-color: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-left: 4px solid #e74c3c;
            padding: 15px;
            border-radius: 4px;
            text-align: center;
        }
        .word-text {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        .word-attempts {
            font-size: 12px;
            color: #666;
            margin-bottom: 4px;
        }
        .word-accuracy {
            font-size: 14px;
            font-weight: bold;
            color: #e74c3c;
        }
        .table-section {
            margin-top: 30px;
        }
        .table-section h3 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #ecf0f1;
            font-weight: bold;
            color: #2c3e50;
        }
        tr:hover {
            background-color: #f9f9f9;
        }
        .empty-message {
            text-align: center;
            padding: 40px 20px;
            color: #27ae60;
            font-weight: bold;
            font-size: 18px;
        }
        .stats-card {
            display: inline-block;
            background-color: #ecf0f1;
            padding: 15px 25px;
            border-radius: 4px;
            margin: 5px;
            text-align: center;
        }
        .stats-number {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }
        .stats-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>âš ï¸ æ‰€æœ‰æœªæŒæ¡å–®è©</h1>
        
        <div id="emptyContainer" style="display: none;">
            <div class="empty-message">
                ğŸ‰ æ­å–œï¼æ‰€æœ‰å–®è©éƒ½å·²æŒæ¡ï¼
            </div>
            <div class="button-group">
                <a href="{{ url_for('vocab_list') }}" class="btn btn-back">â† è¿”å›èª²ç¨‹åˆ—è¡¨</a>
            </div>
        </div>
        
        <div id="contentContainer" style="display: none;">
            <!-- æ‘˜è¦ç›’ -->
            <div class="summary-box">
                <h2>ğŸ“Š çµ±è¨ˆæ‘˜è¦</h2>
                <p><strong>æœªæŒæ¡å–®è©ç¸½æ•¸ï¼š</strong><span id="totalCount">0</span> å€‹</p>
                <p><strong>å¹³å‡æº–ç¢ºç‡ï¼š</strong><span id="avgAccuracy">0</span>%</p>
                <p style="margin-top: 15px; font-size: 14px; color: #555;">
                    æœªæŒæ¡çš„æ¨™æº–ï¼šæœªæ›¾å˜—è©¦éï¼Œæˆ–æ­£ç¢ºç‡ä½æ–¼ 75%
                </p>
            </div>
            
            <!-- è½å¯«æŒ‰éˆ• -->
            <div class="button-group">
                <a href="/quiz_all_unmastered" class="btn btn-quiz" onclick="recordQuizStart(); return true;">ğŸ™ï¸ è½å¯«æ‰€æœ‰æœªæŒæ¡å–®è©</a>
            </div>
            
            <!-- å–®è©ç¶²æ ¼è¦–åœ– -->
            <div id="gridSection" style="display: none;">
                <h3 style="color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; margin-bottom: 15px;">ğŸ“‹ å–®è©åˆ—è¡¨ï¼ˆç¶²æ ¼è¦–åœ–ï¼‰</h3>
                <div class="words-grid" id="wordsGrid"></div>
            </div>
            
            <!-- å–®è©è¡¨æ ¼è¦–åœ– -->
            <div class="table-section">
                <h3>ğŸ“Š å–®è©è©³æƒ…ï¼ˆè¡¨æ ¼è¦–åœ–ï¼‰</h3>
                <table id="wordsTable" style="display: none;">
                    <thead>
                        <tr>
                            <th style="width: 25%;">å–®è©</th>
                            <th style="width: 20%;">å˜—è©¦æ¬¡æ•¸</th>
                            <th style="width: 20%;">æ­£ç¢ºæ¬¡æ•¸</th>
                            <th style="width: 20%;">æº–ç¢ºç‡</th>
                            <th style="width: 15%;">èª²ç¨‹</th>
                        </tr>
                    </thead>
                    <tbody id="wordsTableBody">
                    </tbody>
                </table>
            </div>
            
            <!-- åº•éƒ¨å°èˆª -->
            <div class="button-group" style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #e0e0e0;">
                <a href="{{ url_for('vocab_list') }}" class="btn btn-back">â† è¿”å›èª²ç¨‹åˆ—è¡¨</a>
            </div>
        </div>
    </div>
    
    <script>
        window.addEventListener('DOMContentLoaded', function() {
            loadUnmasteredWords();
        });
        
        function loadUnmasteredWords() {
            fetch('/api/get_unmastered_words')
                .then(response => response.json())
                .then(words => {
                    if (words.length === 0) {
                        document.getElementById('emptyContainer').style.display = 'block';
                        document.getElementById('contentContainer').style.display = 'none';
                    } else {
                        document.getElementById('emptyContainer').style.display = 'none';
                        document.getElementById('contentContainer').style.display = 'block';
                        
                        // æ›´æ–°çµ±è¨ˆä¿¡æ¯
                        document.getElementById('totalCount').textContent = words.length;
                        
                        const avgAccuracy = words.length > 0 
                            ? Math.round(words.reduce((sum, w) => sum + w.accuracy, 0) / words.length)
                            : 0;
                        document.getElementById('avgAccuracy').textContent = avgAccuracy;
                        
                        // å¡«å……ç¶²æ ¼è¦–åœ–
                        const grid = document.getElementById('wordsGrid');
                        grid.innerHTML = '';
                        words.forEach(word => {
                            const card = document.createElement('div');
                            card.className = 'word-card';
                            card.innerHTML = `
                                <div class="word-text">${word.word}</div>
                                <div class="word-attempts">å˜—è©¦: ${word.attempts}æ¬¡</div>
                                <div class="word-accuracy">æº–ç¢ºç‡: ${word.accuracy.toFixed(0)}%</div>
                            `;
                            grid.appendChild(card);
                        });
                        
                        // å¡«å……è¡¨æ ¼è¦–åœ–
                        const tbody = document.getElementById('wordsTableBody');
                        tbody.innerHTML = '';
                        words.forEach(word => {
                            const row = document.createElement('tr');
                            const correct = Math.round(word.attempts * word.accuracy / 100);
                            row.innerHTML = `
                                <td><strong>${word.word}</strong></td>
                                <td>${word.attempts}</td>
                                <td>${correct}</td>
                                <td>
                                    <div style="background-color: #f0f0f0; border-radius: 4px; padding: 5px; text-align: center;">
                                        <strong style="color: ${word.accuracy >= 50 ? '#f39c12' : '#e74c3c'};">${word.accuracy.toFixed(0)}%</strong>
                                    </div>
                                </td>
                                <td style="font-size: 12px; color: #666;">${word.lesson}</td>
                            `;
                            tbody.appendChild(row);
                        });
                        
                        document.getElementById('wordsTable').style.display = 'table';
                        document.getElementById('gridSection').style.display = 'block';
                    }
                })
                .catch(error => {
                    console.error('åŠ è¼‰å¤±æ•—:', error);
                    document.getElementById('emptyContainer').style.display = 'block';
                    document.getElementById('contentContainer').style.display = 'none';
                });
        }
        
        function recordQuizStart() {
            // å¯ä»¥åœ¨é€™è£¡è¨˜éŒ„ç”¨æˆ¶é–‹å§‹è½å¯«çš„æ™‚é–“ç­‰ä¿¡æ¯
            console.log('é–‹å§‹è½å¯«æ‰€æœ‰æœªæŒæ¡å–®è©');
        }
    </script>
</body>
</html>
