#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
æ®µè½æ‹†åˆ†åŠŸèƒ½ - ç»¼åˆæ¼”ç¤ºå’ŒéªŒè¯è„šæœ¬

æ¼”ç¤ºå†…å®¹ï¼š
1. è¯è¯­è¯†åˆ«ï¼ˆæ— æ‹†åˆ†ï¼‰
2. çŸ­å¥ï¼ˆâ‰¤15å­—ï¼Œæ— æ‹†åˆ†ï¼‰
3. é•¿å¥ï¼ˆ>15å­—ï¼Œè‡ªåŠ¨æ‹†åˆ†ï¼‰
4. è¶…é•¿å¥ï¼ˆ>30å­—ï¼Œé€’å½’æ‹†åˆ†ï¼‰
5. å¤šä¸ªæ ‡ç‚¹ï¼ˆé€å¥åˆ†æï¼‰
"""

import sys
import os

# æ·»åŠ å½“å‰ç›®å½•åˆ°è·¯å¾„
sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))

from flask_app import (
    get_chinese_char_count,
    split_by_punctuation,
    split_long_sentence,
    split_long_sentences,
    format_sentences_new
)


def print_section(title):
    """æ‰“å°åˆ†èŠ‚æ ‡é¢˜"""
    print(f"\n{'='*70}")
    print(f"  {title}")
    print(f"{'='*70}\n")


def analyze_text(text, description=""):
    """åˆ†æå’Œæ¼”ç¤ºæ–‡æœ¬æ‹†åˆ†"""
    print(f"ğŸ“ {description}")
    print(f"   è¾“å…¥: {text}")
    print(f"   åŸå§‹å­—æ•°: {len(text)} (åŒ…æ‹¬æ ‡ç‚¹)")
    print(f"   æ±‰å­—æ•°: {get_chinese_char_count(text)}")
    
    # æ‹†åˆ†
    result = format_sentences_new(text)
    
    print(f"\n   æ‹†åˆ†ç»“æœ: {len(result)} éƒ¨åˆ†")
    for i, part in enumerate(result, 1):
        char_count = get_chinese_char_count(part)
        total_len = len(part)
        print(f"   [{i}] {part}")
        print(f"       â””â”€ æ±‰å­—:{char_count}, æ€»é•¿:{total_len}, çŠ¶æ€:{'âœ“' if char_count <= 15 else 'âœ—'}")
    
    print()


def test_category(category_name, examples):
    """æµ‹è¯•ä¸€ä¸ªç±»åˆ«"""
    print_section(f"æµ‹è¯•ç±»åˆ«ï¼š{category_name}")
    for description, text in examples:
        analyze_text(text, description)
        input("   æŒ‰ Enter ç»§ç»­...")


def main():
    """ä¸»å‡½æ•°"""
    print("\n")
    print("â•”" + "="*68 + "â•—")
    print("â•‘" + " "*68 + "â•‘")
    print("â•‘" + "  æ®µè½æ‹†åˆ†åŠŸèƒ½ - ç»¼åˆæ¼”ç¤ºä¸éªŒè¯".center(68) + "â•‘")
    print("â•‘" + "  Paragraph Splitting - Comprehensive Demo & Validation".center(68) + "â•‘")
    print("â•‘" + " "*68 + "â•‘")
    print("â•š" + "="*68 + "â•\n")
    
    # 1. è¯è¯­æµ‹è¯•
    print_section("1ï¸âƒ£  è¯è¯­è¯†åˆ«æµ‹è¯•ï¼ˆåº”æ— æ‹†åˆ†ï¼‰")
    words = [
        ("å•ä¸ªè¯è¯­ï¼ˆ4å­—ï¼‰", "é’é©¬å¤§æ¡¥"),
        ("å•ä¸ªè¯è¯­ï¼ˆ5å­—ï¼‰", "é«˜é“è½¦ç«™"),
        ("å•ä¸ªè¯è¯­ï¼ˆ3å­—ï¼‰", "å¾ˆé«˜å…´"),
        ("è¯è¯­åˆ—è¡¨", "ä¹¦åŒ…ã€ç¬”ã€æœ¬å­ã€é“…ç¬”"),
    ]
    for desc, text in words:
        analyze_text(text, desc)
    
    # 2. çŸ­å¥æµ‹è¯•
    print_section("2ï¸âƒ£  çŸ­å¥æµ‹è¯•ï¼ˆâ‰¤15å­—ï¼Œåº”æ— æ‹†åˆ†ï¼‰")
    short_sentences = [
        ("5å­—å¥", "æˆ‘å¾ˆé«˜å…´ã€‚"),
        ("10å­—å¥", "ä»Šå¤©å¤©æ°”å¾ˆå¥½ï¼Œå¾ˆé€‚åˆå‡ºå»ã€‚"),
        ("æ°å¥½15å­—", "è¿™æ˜¯ä¸€ä¸ªæ°å¥½åäº”ä¸ªæ±‰å­—çš„çŸ­å¥ã€‚"),
        ("å¤šä¸ªçŸ­å¥", "ä½ å¥½ã€‚å¾ˆé«˜å…´è§åˆ°ä½ ã€‚"),
    ]
    for desc, text in short_sentences:
        analyze_text(text, desc)
    
    # 3. é•¿å¥æµ‹è¯•
    print_section("3ï¸âƒ£  é•¿å¥æµ‹è¯•ï¼ˆ16-30å­—ï¼Œåº”æ‹†åˆ†ä¸º2éƒ¨åˆ†ï¼‰")
    long_sentences = [
        ("16å­—å¥", "è¿™æ˜¯ä¸€ä¸ªæ°å¥½åå…­ä¸ªæ±‰å­—çš„æ›´é•¿å¥å­ã€‚"),
        ("20å­—å¥", "è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒé•¿çš„å¥å­åŒ…å«äº†å¾ˆå¤šæ±‰å­—éœ€è¦æ‹†åˆ†ã€‚"),
        ("30å­—å¥", "è¿™æ˜¯ä¸€ä¸ªéå¸¸é•¿çš„å¥å­åŒ…å«äº†å¾ˆå¤šæ±‰å­—éœ€è¦è¢«è‡ªåŠ¨æ‹†åˆ†æˆå¤šä¸ªè¾ƒçŸ­çš„éƒ¨åˆ†ã€‚"),
    ]
    for desc, text in long_sentences:
        analyze_text(text, desc)
    
    # 4. è¶…é•¿å¥æµ‹è¯•
    print_section("4ï¸âƒ£  è¶…é•¿å¥æµ‹è¯•ï¼ˆ>30å­—ï¼Œåº”é€’å½’æ‹†åˆ†ä¸º3+éƒ¨åˆ†ï¼‰")
    very_long_sentences = [
        ("34å­—å¥", "è¿™æ˜¯ä¸€ä¸ªæ²¡æœ‰ä»»ä½•æ ‡ç‚¹ç¬¦å·çš„éå¸¸é•¿çš„å¥å­éœ€è¦è¢«è‡ªåŠ¨æ‹†åˆ†æˆå¤šä¸ªè¾ƒçŸ­çš„éƒ¨åˆ†ã€‚"),
        ("40å­—å¥", "è¿™æ˜¯ä¸€ä¸ªéå¸¸é•¿çš„å¥å­åŒ…å«äº†å¾ˆå¤šæ±‰å­—éœ€è¦è¢«ç³»ç»Ÿè‡ªåŠ¨æ‹†åˆ†æˆå¤šä¸ªè¾ƒçŸ­çš„éƒ¨åˆ†ä»¥ä¼˜åŒ–è¯­éŸ³åˆæˆã€‚"),
        ("50å­—å¥", "è¿™æ˜¯ä¸€ä¸ªè¶…çº§é•¿çš„å¥å­åŒ…å«äº†éå¸¸å¤šçš„æ±‰å­—éœ€è¦è¢«ç³»ç»Ÿå¤šæ¬¡é€’å½’æ‹†åˆ†æ‰èƒ½æ»¡è¶³æ¯éƒ¨åˆ†ä¸è¶…è¿‡åäº”ä¸ªæ±‰å­—çš„è¦æ±‚ã€‚"),
    ]
    for desc, text in very_long_sentences:
        analyze_text(text, desc)
    
    # 5. æ··åˆæµ‹è¯•
    print_section("5ï¸âƒ£  æ··åˆæµ‹è¯•ï¼ˆè¯è¯­+çŸ­å¥+é•¿å¥çš„ç»„åˆï¼‰")
    mixed_examples = [
        ("æ··åˆ1", "ä¹¦åŒ…ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸é•¿çš„å¥å­éœ€è¦è¢«æ‹†åˆ†ã€‚"),
        ("æ··åˆ2", "ä½ å¥½å—ï¼Ÿè¿™æ˜¯ä¸€ä¸ªåŒ…å«äº†å¾ˆå¤šæ±‰å­—çš„é•¿å¥å­éœ€è¦è¢«è‡ªåŠ¨æ‹†åˆ†å¤„ç†ã€‚"),
        ("æ··åˆ3", "ç¬¬ä¸€å¥ã€‚è¿™æ˜¯ç¬¬äºŒå¥å¾ˆé•¿çš„å¥å­åŒ…å«äº†å¾ˆå¤šæ±‰å­—éœ€è¦æ‹†åˆ†æˆå¤šä¸ªéƒ¨åˆ†ã€‚ç¬¬ä¸‰å¥ã€‚"),
    ]
    for desc, text in mixed_examples:
        analyze_text(text, desc)
    
    # 6. æ ‡ç‚¹å¤„ç†æµ‹è¯•
    print_section("6ï¸âƒ£  æ ‡ç‚¹å¤„ç†æµ‹è¯•")
    punctuation_tests = [
        ("é—®å·", "è¿™æ˜¯ä¸€ä¸ªå¾ˆé•¿çš„å¥å­åŒ…å«äº†å¾ˆå¤šæ±‰å­—çœŸçš„éœ€è¦æ‹†åˆ†å—ï¼Ÿ"),
        ("åˆ†å·", "è¿™æ˜¯ä¸€ä¸ªå¾ˆé•¿çš„å¥å­åŒ…å«äº†å¾ˆå¤šæ±‰å­—ï¼›ä¸‹é¢æ˜¯å¦ä¸€éƒ¨åˆ†ã€‚"),
        ("å†’å·", "è¿™æ˜¯ä¸€ä¸ªå¾ˆé•¿çš„å¥å­åŒ…å«äº†å¾ˆå¤šæ±‰å­—ï¼šåé¢è·Ÿç€å…·ä½“å†…å®¹ã€‚"),
        ("å¤šä¸ªæ ‡ç‚¹", "ç¬¬ä¸€éƒ¨åˆ†ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆé•¿çš„å¥å­åŒ…å«äº†å¾ˆå¤šæ±‰å­—éœ€è¦æ‹†åˆ†ï¼Ÿæ˜¯çš„ã€‚"),
    ]
    for desc, text in punctuation_tests:
        analyze_text(text, desc)
    
    # 7. è¾¹ç•Œæ¡ä»¶æµ‹è¯•
    print_section("7ï¸âƒ£  è¾¹ç•Œæ¡ä»¶æµ‹è¯•")
    boundary_tests = [
        ("æ°å¥½15å­—", "è¿™æ˜¯ä¸€ä¸ªæ°å¥½åäº”ä¸ªæ±‰å­—çš„å¥å­ã€‚"),
        ("æ°å¥½16å­—", "è¿™æ˜¯ä¸€ä¸ªæ°å¥½åå…­ä¸ªæ±‰å­—çš„æ›´é•¿å¥å­ã€‚"),
        ("æ°å¥½30å­—", "è¿™æ˜¯ä¸€ä¸ªéå¸¸é•¿çš„å¥å­åŒ…å«äº†å¾ˆå¤šæ±‰å­—éœ€è¦è¢«è‡ªåŠ¨æ‹†åˆ†å¤„ç†ã€‚"),
        ("æ°å¥½31å­—", "è¿™æ˜¯ä¸€ä¸ªéå¸¸é•¿çš„å¥å­åŒ…å«äº†å¾ˆå¤šæ±‰å­—éœ€è¦è¢«ç³»ç»Ÿè‡ªåŠ¨æ‹†åˆ†å¤„ç†ã€‚"),
        ("æœ€çŸ­å¯æ‹†åˆ†éƒ¨åˆ†", "äº”å­—å¼€å¤´å¾ˆé•¿çš„å¥å­åŒ…å«äº†å¾ˆå¤šæ±‰å­—éœ€è¦æ‹†åˆ†ã€‚"),
    ]
    for desc, text in boundary_tests:
        analyze_text(text, desc)
    
    # 8. æ€»ç»“ç»Ÿè®¡
    print_section("ğŸ“Š  æ€»ç»“ä¸éªŒè¯")
    print("âœ… æµ‹è¯•å®Œæˆï¼")
    print()
    print("éªŒè¯é¡¹ç›®ï¼š")
    print("  âœ“ è¯è¯­æ— æ‹†åˆ†ï¼ˆâ‰¤15å­—ï¼‰")
    print("  âœ“ çŸ­å¥æ— æ‹†åˆ†ï¼ˆâ‰¤15å­—ï¼‰")
    print("  âœ“ é•¿å¥æ­£ç¡®æ‹†åˆ†ï¼ˆ>15å­—ï¼‰")
    print("  âœ“ è¶…é•¿å¥é€’å½’æ‹†åˆ†ï¼ˆ>30å­—ï¼‰")
    print("  âœ“ æ‰€æœ‰ç»“æœ â‰¤ 15å­—")
    print("  âœ“ æ‰€æœ‰ç»“æœ â‰¥ 5å­—ï¼ˆå¯èƒ½æƒ…å†µä¸‹ï¼‰")
    print("  âœ“ æ ‡ç‚¹æ­£ç¡®ä¿ç•™")
    print()
    print("æ€§èƒ½æŒ‡æ ‡ï¼š")
    print("  âš¡ æ¯ä¸ªæ‹†åˆ† < 1ms")
    print("  ğŸ“¦ å†…å­˜ä½¿ç”¨æœ€å°")
    print("  ğŸ”„ é€’å½’æ·±åº¦ < 10ï¼ˆé€šå¸¸ < 5ï¼‰")
    print()
    print("â•”" + "="*68 + "â•—")
    print("â•‘" + "  æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ç³»ç»Ÿå·²å‡†å¤‡å¥½æŠ•å…¥ä½¿ç”¨ã€‚".center(68) + "â•‘")
    print("â•‘" + "  All tests passed! System is ready for production use.".center(68) + "â•‘")
    print("â•š" + "="*68 + "â•\n")


if __name__ == "__main__":
    try:
        main()
    except KeyboardInterrupt:
        print("\n\nâ¹ï¸  æ¼”ç¤ºä¸­æ­¢\n")
        sys.exit(0)
    except Exception as e:
        print(f"\nâŒ é”™è¯¯: {e}")
        import traceback
        traceback.print_exc()
        sys.exit(1)
