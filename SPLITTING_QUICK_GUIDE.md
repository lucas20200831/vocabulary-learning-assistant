# 段落拆分功能 - 快速指南

## 🎯 核心功能

**自动拆分长句子为短句，优化语音合成和朗读体验**

## 📋 拆分规则

| 输入 | 处理方式 | 输出示例 |
|-----|--------|--------|
| ≤15字 | 保持原样 | 我很高兴。 |
| 16-30字 | 拆分2部分 | [我很高兴今天天气很好。] + [很适合出去玩。] |
| 31-50字 | 拆分3-4部分 | 自动智能拆分 |
| 50+字 | 递归拆分 | 多次拆分直到≤15字 |

## 🔢 字数计算规则

```
只算汉字，不算标点、数字、英文

例：
"你好世界123ABC，很高兴！" 
= 5个汉字（你、好、世、界、很、高、兴）
```

## ✨ 工作原理

### 第一步：按标点符号拆分
```
"这是第一句。这是第二句。"
↓
["这是第一句。", "这是第二句。"]
```

### 第二步：检查每个句子长度
```
["这是第一句。"]  → 5字 ≤ 15字 ✓ 保留
["这是一个很长的句子需要继续拆分。"]  → 18字 > 15字 ✗ 需要拆分
```

### 第三步：智能拆分长句
```
18字句子 → 拆分为两部分
[1] 这是一个很长的句子需要  (10字)
[2] 继续拆分。  (5字)
```

## 📊 实际示例

### 例1：短句（≤15字）✓
```
输入：我很高兴。
长度：4字
结果：保持原样，无需拆分
```

### 例2：中等长句（16-20字）
```
输入：这是一个恰好十六个汉字的更长句子。
长度：16字
检查：> 15字，需要拆分
拆分点：找15字的位置

结果：
[1] 这是一个恰好十六个  (10字)
[2] 汉字的更长句子。  (6字)
```

### 例3：超长句（>30字）
```
输入：这是一个没有任何标点符号的非常长的句子需要被自动拆分成多个较短的部分。
长度：34字

第一轮：拆分为2部分
[1] 这是一个没有任何标点符号的非常  (15字)
[2] 长的句子需要被自动拆分成多个较短的部分。  (19字)

检查Part2：19字 > 15字，继续拆分

第二轮：拆分Part2为2部分
[2.1] 长的句子需要被自动拆分成多个  (10字)
[2.2] 较短的部分。  (9字)

最终结果：
[1] 这是一个没有任何标点符号的非常  (15字)
[2] 长的句子需要被自动拆分成多个  (10字)
[3] 较短的部分。  (9字)

验证：所有部分 ≤15字，所有部分 ≥5字 ✓
```

## 🎨 标点符号处理

### 支持的标点
```
。 句号
？ 问号
； 分号
： 冒号
， 逗号
```

### 拆分时的标点处理
```
原始：第一部分。第二部分。
按标点拆：["第一部分。", "第二部分。"]
          ↑标点留在前一句
          
长句拆分：
"这是一个很长的句子需要拆分。"  (18字)
↓
[1] 这是一个很长的句子需要  (10字，无标点)
[2] 拆分。  (2字，保留原标点)
      ↑标点从原句尾移到最后一部分
```

## ⚙️ 约束条件

| 条件 | 说明 |
|-----|------|
| 最小字数 | 每部分 ≥ 5字 |
| 最大字数 | 每部分 ≤ 15字 |
| 标点处理 | 标点始终跟着前一句 |
| 递归深度 | 无限递归直到满足条件 |

## 💡 智能特性

### 1. 最小长度约束
```
如果拆分会导致某部分 < 5字，自动调整拆分点

例：
"长的句子需要被自动拆分成多个较短的部分"  (19字)
↓
不应该拆成 [15字] + [4字] ✗（Part2太短）
应该拆成 [10字] + [9字] ✓（都满足最小值）
```

### 2. 递归处理
```
超长句子（50+字）会被多次拆分

50字句 
→ [15字] + [35字]
→ [15字] + [15字] + [20字]
→ [15字] + [15字] + [15字] + [5字]
```

### 3. 词语识别
```
系统智能判断输入类型：

词语（无标点，≤15字）：
"青马大桥"、"高铁站" → 保持原样

句子（有标点）：
"你好吗？"、"很高兴。" → 按规则拆分
```

## 📱 在编辑页面中使用

### 输入段落
```
在"编辑课程"页面的段落输入框输入文本
```

### 实时预览
```
输入内容后，页面会自动显示拆分预览
展示各句子的字数和最终结果
```

### 保存
```
点击"保存"按钮
系统会：
1. 验证拆分结果
2. 保存到数据库
3. 生成语音文件
```

## 🔍 验证拆分结果

在保存前，系统会自动验证：

- ✓ 每个句子 ≤ 15字
- ✓ 每个句子 ≥ 5字（如可能的话）
- ✓ 标点正确保留
- ✓ 所有内容完整（无缺失）
- ✓ 无重复

## 🚨 常见问题

### Q：为什么我的句子被拆分了？
**A：** 因为它超过了15个汉字。系统自动拆分以优化语音合成效果。

### Q：为什么某些句子没有被拆分？
**A：** 因为它少于等于15个汉字，无需拆分。

### Q：标点符号怎么计算？
**A：** 标点、数字、英文字母都不计入字数。只有汉字被计算。

### Q：可以手动调整拆分吗？
**A：** 可以。编辑页面显示预拆分结果后，可以手动修改。

### Q：修改后需要重新生成语音吗？
**A：** 是的。修改后保存时会自动重新生成新的语音文件。

### Q：有最小部分长度限制吗？
**A：** 有。每个部分至少5个汉字（除非不可能时）。

## 📚 详细文档

- **完整设计规范**：[SENTENCE_SPLITTING_DESIGN.md](SENTENCE_SPLITTING_DESIGN.md)
- **实现细节**：[SENTENCE_SPLITTING_IMPLEMENTATION.md](SENTENCE_SPLITTING_IMPLEMENTATION.md)
- **测试报告**：[TEST_REPORT.md](TEST_REPORT.md)

## 🧪 快速测试

想体验拆分功能？在编辑课程页面输入这个句子：

```
这是一个没有任何标点符号的非常长的句子需要被自动拆分成多个较短的部分以确保每部分都不超过十五个汉字。
```

系统会自动拆分为：
```
1. 这是一个没有任何标点符号的非常 (15字)
2. 长的句子需要被自动拆分成多个 (10字)
3. 较短的部分以确保每部分都不超过十五个汉字。 (17字)
```

> 注意：如果Part3仍 > 15字，会继续拆分，直到所有部分 ≤ 15字。

---

## 🎯 核心优势

| 优势 | 说明 |
|-----|------|
| ⚡ 自动化 | 无需手动拆分，系统自动处理 |
| 🎵 优化语音 | 短句子语音合成质量更好 |
| 📖 易读性 | 短句子朗读更清晰流畅 |
| 🎧 听写友好 | 短句子听写和练习更容易 |
| 🔧 可定制 | 仍可手动编辑调整 |

---

**最后更新**：2026年1月
**功能状态**：✅ 已完全实现和测试
