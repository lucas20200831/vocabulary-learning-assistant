# 新段落结构使用指南

## 快速开始

### 1. 查看课程列表

访问 `/vocab_list` 页面，现在每个段落都有自己的"🎙️ 聽寫"按钮。

**旧方式**：
- 只能选择"聽寫段落"来测试所有段落

**新方式** ✨：
- 点击特定段落旁的"🎙️ 聽寫"按钮，可以单独测试该段落
- 也可以点击顶部的"🎙️ 聽寫段落"来测试所有段落

### 2. 编辑段落

访问编辑页面时：

**新功能**：
- 每个段落现在有独立的标题编辑框
- 可以为每个段落自定义名称（例如：我的家庭、学校用品等）
- 标题会被保存并显示在各个界面

### 3. 查看统计信息

在统计页面 (`/stats/<language>/<lesson>`)：

**新信息**：
- 每个段落显示学习进度百分比
- 显示该段落的整体测试次数和准确率
- 每个段落有独立的"🎙️ 聽寫此段落"按钮

## URL参数说明

### 选择特定段落进行听写

```
/quiz/<language>/<lesson>?content_type=段落&paragraph_id=para_1
```

- `content_type=段落`: 表示进行段落听写
- `paragraph_id=para_1`: 指定要测试的段落ID（可选）

**例子**：
- 测试所有段落: `/quiz/中文/第一課?content_type=段落`
- 测试第1个段落: `/quiz/中文/第一課?content_type=段落&paragraph_id=para_1`
- 测试第2个段落: `/quiz/中文/第一課?content_type=段落&paragraph_id=para_2`

## 数据结构示例

### 单个段落的数据：

```json
{
  "id": "para_1",                    // 段落唯一ID
  "title": "我的家庭",               // 段落标题
  "sentences": [                      // 句子列表
    {
      "sentence": "我有一个妈妈",
      "attempts": 5,                  // 该句子被测试的次数
      "correct": 4,
      "incorrect": 1,
      "history": [...]
    }
  ],
  "attempts": 5,                      // 该段落被测试的次数
  "correct": 4,
  "incorrect": 1,
  "history": [...]                    // 段落测试历史
}
```

## 主要改进

| 方面 | 改进 |
|-----|-----|
| **管理** | 每个段落现在是独立的学习项 |
| **统计** | 段落有独立的学习统计数据 |
| **编辑** | 支持自定义段落标题 |
| **灵活性** | 可以选择单个段落或所有段落进行听写 |
| **一致性** | 段落结构与词语结构保持统一 |

## 常见操作

### 操作1：为段落更新标题

1. 进入编辑页面：点击课程列表中的"✏️ 編輯"
2. 修改每个段落的标题框
3. 点击"💾 保存"

### 操作2：单独练习某个段落

1. 在课程列表页面，找到要练习的段落
2. 点击该段落旁的"🎙️ 聽寫"按钮
3. 只有该段落的句子会被显示用于听写

### 操作3：查看段落的学习进度

1. 在课程列表或统计页面
2. 查看每个段落旁显示的进度信息
3. 点击"🎙️ 聽寫此段落"来进一步练习

## 技术变更

### 后端变更

- **新路由参数**: `quiz_new()` 现在支持 `paragraph_id` 参数
- **新字段**: 段落现在有 `id`, `attempts`, `correct`, `incorrect`, `history`
- **新函数**: `migrate_paragraphs.py` 用于数据迁移

### 前端变更

- **新UI**: 每个段落显示独立的听写按钮
- **新表单**: 编辑页面为每个段落添加标题输入框
- **新显示**: 统计页面显示段落级别的信息

## 迁移说明

✓ 已自动执行迁移脚本
✓ 所有现有数据已转换，无数据丢失
✓ 可以安全使用新功能

## 故障排查

### 问题：看不到段落旁的听写按钮

**解决**：
1. 刷新浏览器页面（Ctrl+R 或 F5）
2. 清除浏览器缓存
3. 确保段落列表不为空

### 问题：编辑页面没有显示标题输入框

**解决**：
1. 检查是否是在编辑现有课程
2. 刷新页面
3. 查看浏览器控制台（F12）是否有错误

### 问题：段落听写没有保存进度

**解决**：
1. 检查网络连接
2. 查看浏览器控制台是否有错误
3. 确保数据保存成功（应该看到"已保存"提示）

## 更多信息

详见 `PARAGRAPH_STRUCTURE_IMPROVEMENT.md` 获取完整的技术文档。
